
# Мониторинг сетевого трафика

## Roadmap

- [ ] учесть давность принятия пакета (таймер для вычитания)
- [ ] что-то еще, помимо объема. тип?

## Запуск

```bash
sudo apt install python3-tk
sudo apt install python3-scapy

sudo apt install iptables

cd   # project dir
sudo -E python3 netw-monitor.py
```

## Архитектура

```
 [другой компьютер]
         ↓
= интернет/лок.сеть =
         ↓
[сетевой интерфейс ПК]
         ↓
    [ядро Linux]  ← iptables  # изменить сетевой фильтр
         ↓
    scapy.sniff()    # получить копию пакета
         ↓
  packet_callback()  # получить число байт по IP
         ↓
    [tkinter GUI]
```

## `class Network`

| Функция                                       | Назначение                                                  |
|-----------------------------------------------|-------------------------------------------------------------|
| `__init__(self, root)`                        | Инициализация GUI                                           |
| `packet_callback(self, packet: scapy.Packet)` | Обработчик одного полученного пакета                        |
| `start_monitoring(self)`                      | Запустить мониторинг: очистить таблицы и активировать sniff |
| `monitor_traffic(self)`                       | Фоновая функция для захвата пакетов                         |
| `stop_monitoring(self)`                       | Остановить мониторинг                                       |
| `block_ip(self)`                              | Заблокировать выбранный подозрительный IP                   |
| `unblock_ip(self)`                            | Разблокировать выбранный IP                                 |
| `add_iptables_rule(self, ip_address: str)`    | Добавить правило iptables для блокировки IP                 |
| `remove_iptables_rule(self, ip_address: str)` | Удалить правило iptables для IP                             |

## Что может иметь IP-адрес

1. Физическое устройство, подключенное к сети.  
     - компьютер
     - сервер
     - маршрутизатор
     - камера и тд

2. Отдельный сетевой интерфейс. Несколько на одном ПК.  
     `ip addr`  
     - loopback (lo) (127.0.0.1) - внутренний интерфейс ПК
     - Ethernet
     - Wi-Fi

3. Виртуальное устройство (интерфейс - туннель).
     - контейнер (Docker)
     - виртуальная машина
     - VPN-интерфейс

4. Маршрутизатор (роутер).  
   Cоединяет две сети и пересылает пакеты между ними.  
     - внутренний IP (LAN): доступен для ПК
     - внешний IP (WAN): выдан провайдером
